"use strict";var MIMSAds=(()=>{var g=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var E=(t,i)=>{for(var l in i)g(t,l,{get:i[l],enumerable:!0})},U=(t,i,l,c)=>{if(i&&typeof i=="object"||typeof i=="function")for(let d of T(i))!x.call(t,d)&&d!==l&&g(t,d,{get:()=>i[d],enumerable:!(c=k(i,d))||c.enumerable});return t};var R=t=>U(g({},"__esModule",{value:!0}),t);var P={};E(P,{default:()=>O});function $(){let t=localStorage.getItem("mims_user_id");if(t)return t;let i="u_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return localStorage.setItem("mims_user_id",i),i}var u=function(){let t={serverUrl:"",userId:"",platform:"web",country:""},i=new Map,l=new Map,c=new Map,d=new Map;function p(e){t={...t,...e,userId:e.userId||$()},t.country||w()}function w(){let e=Intl.DateTimeFormat().resolvedOptions().timeZone,n={"Asia/Singapore":"sg","Asia/Kuala_Lumpur":"my","Asia/Manila":"ph","Asia/Jakarta":"id","Asia/Bangkok":"th","Asia/Ho_Chi_Minh":"vn"};t.country=n[e]||"unknown"}function y(e,n){i.set(e,{...n,elementId:n.elementId||e})}function v(e,n){l.set(e,n)}function M(){l.clear()}async function f(){if(!t.serverUrl){console.error("MIMSAds: Server URL not configured. Call MIMSAds.init() first.");return}if(i.size===0){console.warn("MIMSAds: No slots defined. Call MIMSAds.defineSlot() first.");return}try{let e=Array.from(i.entries()).map(([s,a])=>({id:s,width:a.width,height:a.height,ad_unit:a.adUnit||""})),n={};l.forEach((s,a)=>{n[a]=s});let r=await fetch(`${t.serverUrl}/v1/ads`,{method:"POST",headers:{"Content-Type":"application/json","X-User-ID":t.userId||""},body:JSON.stringify({slots:e,targeting:n,user_id:t.userId,platform:t.platform,country:t.country})});if(!r.ok)throw new Error(`HTTP ${r.status}`);let o=await r.json();if(o.ads&&Array.isArray(o.ads))for(let s of o.ads)I(s)}catch(e){console.error("MIMSAds: Failed to fetch ads",e)}}function I(e){let n=i.get(e.slot_id);if(!n)return;let r=document.getElementById(n.elementId||e.slot_id);if(!r){console.warn(`MIMSAds: Container element not found for slot ${e.slot_id}`);return}c.set(e.slot_id,e);let o=document.createElement("div");o.id=`mims-ad-${e.slot_id}`,o.style.cssText=`
      width: ${e.width}px;
      height: ${e.height}px;
      position: relative;
      overflow: hidden;
    `;let s=document.createElement("a");s.href=e.tracking.click,s.target="_blank",s.rel="noopener noreferrer",s.style.display="block";let a=document.createElement("img");a.src=e.image_url,a.alt="Advertisement",a.style.cssText=`
      width: ${e.width}px;
      height: ${e.height}px;
      display: block;
      border: none;
    `,s.appendChild(a),o.appendChild(s),r.innerHTML="",r.appendChild(o),m(e.tracking.impression),b(e,o)}function m(e){let n=new Image(1,1);n.src=e}function b(e,n){let r=null,o=!1,s=new IntersectionObserver(a=>{for(let C of a)C.intersectionRatio>=.5?!r&&!o&&(r=window.setTimeout(()=>{o||(o=!0,m(e.tracking.viewable))},1e3)):r&&(clearTimeout(r),r=null)},{threshold:[0,.5,1]});s.observe(n),d.set(e.slot_id,s)}function h(){d.forEach(e=>{e.disconnect()}),d.clear(),c.forEach((e,n)=>{let r=i.get(n);if(r){let o=document.getElementById(r.elementId||n);o&&(o.innerHTML="")}}),c.clear()}async function A(){h(),await f()}function _(){return{...t}}function S(){return t.userId||""}return{init:p,defineSlot:y,setTargeting:v,clearTargeting:M,display:f,refresh:A,destroyAll:h,getConfig:_,getUserId:S}}();typeof module<"u"&&module.exports&&(module.exports=u);window.MIMSAds=u;var O=u;return R(P);})();
