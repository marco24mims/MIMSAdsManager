"use strict";
/**
 * MIMS Ad Manager - JavaScript Ad Tag v1.0.0
 * Pre-built for direct inclusion in web pages
 */
var MIMSAds=function(){"use strict";function e(){var e=localStorage.getItem("mims_user_id");if(e)return e;var t="u_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return localStorage.setItem("mims_user_id",t),t}var t={serverUrl:"",userId:"",platform:"web",country:""},n=new Map,r=new Map,o=new Map,a=new Map;function i(e){t=Object.assign(Object.assign({},t),e,{userId:e.userId||function(){var e=localStorage.getItem("mims_user_id");if(e)return e;var t="u_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return localStorage.setItem("mims_user_id",t),t}()}),t.country||s()}function s(){var e=Intl.DateTimeFormat().resolvedOptions().timeZone,n={"Asia/Singapore":"sg","Asia/Kuala_Lumpur":"my","Asia/Manila":"ph","Asia/Jakarta":"id","Asia/Bangkok":"th","Asia/Ho_Chi_Minh":"vn"};t.country=n[e]||"unknown"}function c(e,t){n.set(e,Object.assign(Object.assign({},t),{elementId:t.elementId||e}))}function u(e,t){r.set(e,t)}function l(){r.clear()}function d(){return p.apply(this,arguments)}function p(){return(p=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){f(a,r,o,i,s,"next",e)}function s(e){f(a,r,o,i,s,"throw",e)}i(void 0)})}}(function*(){if(!t.serverUrl)return void console.error("MIMSAds: Server URL not configured. Call MIMSAds.init() first.");if(0===n.size)return void console.warn("MIMSAds: No slots defined. Call MIMSAds.defineSlot() first.");try{var e=Array.from(n.entries()).map(function(e){var t=e[0],n=e[1];return{id:t,width:n.width,height:n.height}}),o={};r.forEach(function(e,t){o[t]=e});var a=yield fetch(t.serverUrl+"/v1/ads",{method:"POST",headers:{"Content-Type":"application/json","X-User-ID":t.userId||""},body:JSON.stringify({slots:e,targeting:o,user_id:t.userId,platform:t.platform,country:t.country})});if(!a.ok)throw new Error("HTTP "+a.status);var i=yield a.json();if(i.ads&&Array.isArray(i.ads))for(var s=0,c=i.ads;s<c.length;s++){var u=c[s];m(u)}}catch(e){console.error("MIMSAds: Failed to fetch ads",e)}})).apply(this,arguments)}function f(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function m(e){var t=n.get(e.slot_id);if(t){var r=document.getElementById(t.elementId||e.slot_id);if(r){o.set(e.slot_id,e);var i=document.createElement("div");i.id="mims-ad-"+e.slot_id,i.style.cssText="\n      width: "+e.width+"px;\n      height: "+e.height+"px;\n      position: relative;\n      overflow: hidden;\n    ";var s=document.createElement("a");s.href=e.tracking.click,s.target="_blank",s.rel="noopener noreferrer",s.style.display="block";var c=document.createElement("img");c.src=e.image_url,c.alt="Advertisement",c.style.cssText="\n      width: "+e.width+"px;\n      height: "+e.height+"px;\n      display: block;\n      border: none;\n    ",s.appendChild(c),i.appendChild(s),r.innerHTML="",r.appendChild(i),g(e.tracking.impression),h(e,i)}else console.warn("MIMSAds: Container element not found for slot "+e.slot_id)}}function g(e){(new Image(1,1)).src=e}function h(e,t){var n=null,r=!1,o=new IntersectionObserver(function(t){for(var o=0,a=t;o<a.length;o++){var i=a[o];i.intersectionRatio>=.5?n||r||(n=window.setTimeout(function(){r||(r=!0,g(e.tracking.viewable))},1e3)):n&&(clearTimeout(n),n=null)}},{threshold:[0,.5,1]});o.observe(t),a.set(e.slot_id,o)}function v(){a.forEach(function(e){e.disconnect()}),a.clear(),o.forEach(function(e,t){var r=n.get(t);if(r){var o=document.getElementById(r.elementId||t);o&&(o.innerHTML="")}}),o.clear()}function y(){return w.apply(this,arguments)}function w(){return(w=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){f(a,r,o,i,s,"next",e)}function s(e){f(a,r,o,i,s,"throw",e)}i(void 0)})}}(function*(){v(),yield d()})).apply(this,arguments)}return{init:i,defineSlot:c,setTargeting:u,clearTargeting:l,display:d,refresh:y,destroyAll:v,getConfig:function(){return Object.assign({},t)},getUserId:function(){return t.userId||""}}}();
"undefined"!=typeof module&&module.exports&&(module.exports=MIMSAds),window.MIMSAds=MIMSAds;
